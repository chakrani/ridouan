<!DOCTYPE HTML>
<!DOCTYPE html PUBLIC "" ""><HTML lang="en"><HEAD><META content="IE=11.0000" 
http-equiv="X-UA-Compatible">
         
<META charset="utf-8">         
<META http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">         
<META name="description" content="A JavaScript Computer Vision Library">         
<META name="author" content="Eugene Zatepyakin">         <TITLE>JSFeat - 
JavaScript Computer Vision Library.</TITLE>         <LINK href="js/css.css" 
rel="stylesheet">         <LINK href="js/bootstrap.css" 
rel="stylesheet">         <LINK href="js/jsfeat.css" 
rel="stylesheet">         

     
<META name="GENERATOR" content="MSHTML 11.00.10570.1001"></HEAD>     
<BODY>
<table style='width:100%;height:100%'><tr><td align='center' valign='middle'>
<VIDEO width="640" height="480" id="webcam" 
style="display: none;"></VIDEO>             
<DIV style="margin: 10px auto; width: 640px; height: 480px;"><CANVAS width="640" 
height="480" id="canvas"></CANVAS>                 
<DIV class="alert alert-error" id="no_rtc" style="display: none;"></DIV>
<DIV class="alert alert-info" id="log" style='display:none'></DIV></DIV>
<SCRIPT src="js/jquery.min.js" type="text/javascript"></SCRIPT>
         
<SCRIPT src="js/jsfeat-min.js" type="text/javascript"></SCRIPT>
         
<SCRIPT src="js/compatibility.js" type="text/javascript"></SCRIPT>
         
<SCRIPT src="js/profiler.js" type="text/javascript"></SCRIPT>
         
<SCRIPT src="js/dat.gui.min.js" type="text/javascript"></SCRIPT>
         
<SCRIPT type="text/javascript">

        $(window).load(function() {
            "use strict";

            // lets do some fun
            var video = document.getElementById('webcam');
            var canvas = document.getElementById('canvas');
            try {
                var attempts = 0;
                var readyListener = function(event) {
                    findVideoSize();
                };
                var findVideoSize = function() {
                    if(video.videoWidth > 0 && video.videoHeight > 0) {
                        video.removeEventListener('loadeddata', readyListener);
                        onDimensionsReady(video.videoWidth, video.videoHeight);
                    } else {
                        if(attempts < 10) {
                            attempts++;
                            setTimeout(findVideoSize, 200);
                        } else {
                            onDimensionsReady(640, 480);
                        }
                    }
                };
                var onDimensionsReady = function(width, height) {
                    demo_app(width, height);
                    compatibility.requestAnimationFrame(tick);
                };

                video.addEventListener('loadeddata', readyListener);

                compatibility.getUserMedia({video: true}, function(stream) {
                    if(video.srcObject !== undefined){
                        video.srcObject = stream
                    } else {
                        try {
                            video.src = compatibility.URL.createObjectURL(stream);
                        } catch (error) {
                            video.src = stream;
                        }
                    }
                    setTimeout(function() {
                            video.play();
                        }, 500);
                }, function (error) {
                    $('#canvas').hide();
                    $('#log').hide();
                    $('#no_rtc').html('<h4>WebRTC not available.</h4>');
                    $('#no_rtc').show();
                });
            } catch (error) {
                $('#canvas').hide();
                $('#log').hide();
                $('#no_rtc').html('<h4>Something goes wrong...</h4>');
                $('#no_rtc').show();
            }

            var stat = new profiler();

            var gui,options,ctx,canvasWidth,canvasHeight;
            var img_u8;

            var demo_opt = function(){
                this.blur_radius = 2;
                this.low_threshold = 20;
                this.high_threshold = 50;
            }

            function demo_app(videoWidth, videoHeight) {
                canvasWidth  = canvas.width;
                canvasHeight = canvas.height;
                ctx = canvas.getContext('2d');

                ctx.fillStyle = "rgb(0,255,0)";
                ctx.strokeStyle = "rgb(0,255,0)";

                img_u8 = new jsfeat.matrix_t(640, 480, jsfeat.U8C1_t);

                options = new demo_opt();
                gui = new dat.GUI();

                gui.add(options, 'blur_radius', 0, 4).step(1);
                gui.add(options, 'low_threshold', 1, 127).step(1);
                gui.add(options, 'high_threshold', 1, 127).step(1);

                stat.add("grayscale");
                stat.add("gauss blur");
                stat.add("canny edge");
            }

            function tick() {
                compatibility.requestAnimationFrame(tick);
                stat.new_frame();
                if (video.readyState === video.HAVE_ENOUGH_DATA) {
                    ctx.drawImage(video, 0, 0, 640, 480);
                    var imageData = ctx.getImageData(0, 0, 640, 480);

                    stat.start("grayscale");
                    jsfeat.imgproc.grayscale(imageData.data, 640, 480, img_u8);
                    stat.stop("grayscale");

                    var r = options.blur_radius|0;
                    var kernel_size = (r+1) << 1;

                    stat.start("gauss blur");
                    jsfeat.imgproc.gaussian_blur(img_u8, img_u8, kernel_size, 0);
                    stat.stop("gauss blur");

                    stat.start("canny edge");
                    jsfeat.imgproc.canny(img_u8, img_u8, options.low_threshold|0, options.high_threshold|0);
                    stat.stop("canny edge");

                    // render result back to canvas
                    var data_u32 = new Uint32Array(imageData.data.buffer);
                    var alpha = (0xff << 24);
                    var i = img_u8.cols*img_u8.rows, pix = 0;
                    while(--i >= 0) {
                        pix = img_u8.data[i];
                        data_u32[i] = alpha | (pix << 16) | (pix << 8) | pix;
                    }

                    ctx.putImageData(imageData, 0, 0);

                    $('#log').html(stat.log());
                }
            }

            $(window).unload(function() {
                video.pause();
                video.src=null;
            });
        });
        </SCRIPT>
		</td>
		</tr>
		</table>
     </BODY></HTML>
